{
  "$schema": "../../node_modules/nx/schemas/project-schema.json",
  "targets": {
    "clean": {
      "executor": "nx:run-commands",
      "options": {
        "command": "rimraf modules",
        "cwd": "packages/esl"
      },
      "cache": false,
      "outputs": []
    },

    "build": {
      "executor": "nx:noop",
      "dependsOn": [
        "build:ts",
        "build:less",
        "build:docs"
      ]
    },
    "watch": {
      "executor": "nx:noop",
      "dependsOn": [
        "watch:ts",
        "watch:less",
        "watch:docs"
      ]
    },

    "build:ts": {
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "rimraf -g \"modules/**/*.{js,ts}\"",
          "tsc --project tsconfig.build.json"
        ],
        "parallel": false,
        "cwd": "packages/esl"
      },
      "cache": true,
      "inputs": [
        "{projectRoot}/src/**/*.ts",
        "{projectRoot}/tsconfig.json"
      ],
      "outputs": [
        "{projectRoot}/modules/**/*.js",
        "{projectRoot}/modules/**/*.d.ts"
      ]
    },
    "watch:ts": {
      "executor": "nx:run-commands",
      "options": {
        "command": "tsc --project tsconfig.build.json --watch",
        "cwd": "packages/esl"
      }
    },

    "build:less": {
      "executor": "nx:run-commands",
      "options": {
        "commands": [
          "cpy \"src/**/*.less\" \"modules\" --parents --clean",
          "findx \"modules/{*,*/*,{esl-utils,esl-forms}/*/*}.less !**/*.mixin.less\" \"lessc {{path}} {{dir}}/{{name}}.css\""
        ],
        "cwd": "packages/esl",
        "parallel": false
      },
      "cache": true,
      "inputs": [
        "{projectRoot}/src/**/*.css",
        "{projectRoot}/src/**/*.less"
      ],
      "outputs": [
        "{projectRoot}/modules/**/*.css",
        "{projectRoot}/modules/**/*.less"
      ]
    },
    "watch:less": {
      "executor": "nx:run-commands",
      "dependsOn": ["build:less"],
      "options": {
        "command": "chokidar \"src/**/*.less\" -c \"nx run @exadel/esl:build:less\"",
        "cwd": "packages/esl"
      }
    },

    "build:docs": {
      "executor": "nx:run-commands",
      "options": {
        "command": "cpy \"src/**/*.md\" \"modules\" --parents --clean",
        "cwd": "packages/esl"
      },
      "cache": true,
      "inputs": [
        "{projectRoot}/src/**/*.md"
      ],
      "outputs": [
        "{projectRoot}/modules/**/*.md"
      ]
    },
    "watch:docs": {
      "executor": "nx:run-commands",
      "dependsOn": ["build:docs"],
      "options": {
        "command": "chokidar \"src/**/*.md\" -c \"nx run @exadel/esl:build:docs\"",
        "cwd": "packages/esl"
      }
    },

    "lint": {
      "executor": "nx:noop",
      "dependsOn": ["lint:eslint", "lint:stylelint"]
    },
    "lint:eslint": {
      "executor": "nx:run-commands",
      "dependsOn": [
        "@exadel/eslint-plugin-esl:build"
      ],
      "options": {
        "command": "eslint \"src/**/*.ts\" --max-warnings 3",
        "cwd": "packages/esl"
      },
      "cache": true,
      "inputs": [
        "{projectRoot}/src/**/*.ts",
        "{projectRoot}/eslint.config.mjs"
      ]
    },
    "lint:stylelint": {
      "executor": "nx:run-commands",
      "options": {
        "command": "stylelint \"src/**/*.less\"",
        "cwd": "packages/esl"
      },
      "cache": true,
      "inputs": [
        "{projectRoot}/src/**/*.less",
        "{projectRoot}/.stylelint.yml"
      ]
    },

    "test": {
      "executor": "nx:run-commands",
      "dependsOn": ["build:ts"],
      "options": {
        "command": "jest --silent",
        "cwd": "packages/esl"
      },
      "cache": true,
      "inputs": [
        "{projectRoot}/src/**/*.ts",
        "{projectRoot}/jest.config.ts"
      ],
      "outputs": [
        "{projectRoot}/coverage/**/*.{json,lcov,html}"
      ]
    },

    "pack": {
      "executor": "nx:run-commands",
      "options": {
        "command": "npm pack --pack-destination=../../target/",
        "cwd": "packages/esl"
      },
      "cache": true,
      "outputs": [
        "{workspaceRoot}/target/exadel-esl-*.tgz"
      ]
    }
  }
}
